<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LLM Code Analyzer</title>
    <!-- Orbitron font for cyberpunk look -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Mobile-first base styles */
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            min-height: 100vh;
            font-family: 'Orbitron', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #39ff14;
            margin: 0;
            padding: 0;
            font-size: 14px; /* Base font size for mobile */
        }
        
        .cyber-container {
            max-width: 100%;
            margin: 10px;
            background: rgba(10, 20, 30, 0.95);
            border-radius: 12px;
            box-shadow: 0 0 20px #39ff14, 0 0 5px #00fff7 inset;
            padding: 20px 15px;
            border: 2px solid #39ff14;
        }
        
        .cyber-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .cyber-header h1 {
            font-size: 1.8em;
            color: #39ff14;
            text-shadow: 0 0 8px #39ff14, 0 0 16px #00fff7;
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .cyber-header p {
            color: #00fff7;
            font-size: 1em;
            text-shadow: 0 0 4px #00fff7;
            line-height: 1.4;
        }
        
        .mobile-nav-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(15, 32, 39, 0.8);
            border: 2px solid #39ff14;
            border-radius: 8px;
            align-self: flex-start;
        }
        
        .mobile-nav-toggle span {
            width: 25px;
            height: 3px;
            background: #39ff14;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }
        
        .mobile-nav-toggle.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }
        
        .mobile-nav-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        
        .mobile-nav-toggle.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }
        
        .cyber-tabs {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            gap: 32px;
            width: 100%;
        }
        
        .cyber-tab {
            padding: 16px 24px;
            font-size: 1.1em;
            background: none;
            border: none;
            color: #7fffd4;
            transition: color 0.2s, border-bottom 0.2s;
            position: relative;
            z-index: 1;
            border-bottom: 3px solid transparent;
            border-radius: 0;
            outline: none;
        }
        
        .cyber-tab.active {
            color: #00fff7;
            border-bottom: 3px solid #39ff14;
            background: none;
            box-shadow: none;
        }
        
        .cyber-tab:hover, .cyber-tab:focus {
            color: #39ff14;
            border-bottom: 3px solid #39ff14;
            background: none;
            z-index: 2;
        }
        
        .cyber-tab:last-child {
            margin-right: 0;
            border-right: none;
        }
        
        .cyber-content {
            display: none;
        }
        
        .cyber-content.active {
            display: block;
        }
        
        .cyber-label {
            font-size: 1em;
            color: #00fff7;
            margin-bottom: 6px;
            display: block;
            letter-spacing: 0.5px;
        }
        
        .cyber-textarea {
            width: 100%;
            min-height: 120px;
            background: #0f2027;
            color: #39ff14;
            border: 2px solid #39ff14;
            border-radius: 8px;
            font-size: 0.9em;
            font-family: 'Fira Mono', 'Courier New', monospace;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 0 0 8px #00fff7 inset;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
            resize: vertical;
        }
        
        .cyber-textarea:focus {
            border: 2px solid #00fff7;
            box-shadow: 0 0 12px #39ff14, 0 0 6px #00fff7 inset;
        }
        
        .cyber-btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .cyber-btn {
            padding: 12px 8px;
            background: linear-gradient(90deg, #39ff14 0%, #00fff7 100%);
            color: #0f2027;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9em;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            box-shadow: 0 0 12px #39ff14, 0 0 6px #00fff7 inset;
            cursor: pointer;
            letter-spacing: 0.5px;
            text-shadow: 0 0 4px #fff;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            min-height: 44px; /* Touch-friendly minimum height */
        }
        
        .cyber-btn:hover {
            background: linear-gradient(90deg, #00fff7 0%, #39ff14 100%);
            color: #0f2027;
            box-shadow: 0 0 16px #00fff7, 0 0 8px #39ff14 inset;
        }
        
        .cyber-results {
            margin-top: 20px;
        }
        
        .cyber-result-card {
            background: rgba(15,32,39,0.95);
            border: 2px solid #00fff7;
            border-radius: 10px;
            box-shadow: 0 0 12px #00fff7, 0 0 6px #39ff14 inset;
            padding: 15px;
            margin-bottom: 15px;
            color: #39ff14;
            word-wrap: break-word;
        }
        
        .cyber-result-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .cyber-quality-score {
            background: linear-gradient(90deg, #39ff14 0%, #00fff7 100%);
            color: #0f2027;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 0 6px #39ff14;
            align-self: flex-start;
        }
        
        .cyber-model-name {
            color: #00fff7;
            font-weight: bold;
            font-size: 1em;
        }
        
        .cyber-execution-time {
            color: #fff;
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .cyber-section-title {
            color: #00fff7;
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 5px;
            text-shadow: 0 0 6px #00fff7;
        }
        
        .cyber-section-content {
            color: #39ff14;
            font-size: 0.95em;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        /* Analysis mode radio buttons */
        .analysis-mode-group {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(15, 32, 39, 0.5);
            border-radius: 8px;
            border: 1px solid #39ff14;
        }
        
        .analysis-mode-group label {
            display: block;
            margin-bottom: 8px;
            color: #00fff7;
            font-size: 0.9em;
        }
        
        .analysis-mode-group input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            background: #0f2027;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00fff7;
            border-radius: 6px;
        }
        
        /* Multi-Modal Analysis Styles */
        .cyber-upload-zone {
            border: 2px dashed #39ff14;
            border-radius: 10px;
            padding: 25px 15px;
            text-align: center;
            background: rgba(57, 255, 20, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 15px;
            z-index: 10 !important;
            position: relative;
        }
        
        .cyber-upload-zone:hover, .cyber-upload-zone.dragover {
            border-color: #00fff7;
            background: rgba(0, 255, 247, 0.1);
            box-shadow: 0 0 15px #00fff7;
        }
        
        .cyber-upload-icon {
            font-size: 2.5em;
            color: #39ff14;
            margin-bottom: 12px;
            text-shadow: 0 0 8px #39ff14;
        }
        
        .cyber-upload-text {
            color: #00fff7;
            font-size: 1.1em;
            margin-bottom: 6px;
        }
        
        .cyber-upload-hint {
            color: #00fff7;
            font-size: 0.8em;
            margin-top: 6px;
        }
        
        .cyber-image-preview {
            max-width: 100%;
            max-height: 200px;
            border: 2px solid #39ff14;
            border-radius: 6px;
            margin: 12px 0;
            box-shadow: 0 0 8px #39ff14;
        }
        
        .cyber-image-info {
            background: rgba(15, 32, 39, 0.8);
            border: 1px solid #00fff7;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            color: #39ff14;
            font-size: 0.9em;
        }
        
        .cyber-prompt-input {
            width: 100%;
            min-height: 60px;
            background: #0f2027;
            color: #39ff14;
            border: 2px solid #39ff14;
            border-radius: 6px;
            font-size: 0.9em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 0 6px #00fff7 inset;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
            resize: vertical;
            z-index: 1;
            position: relative;
        }
        
        .cyber-prompt-input:focus {
            border: 2px solid #00fff7;
            box-shadow: 0 0 10px #39ff14, 0 0 5px #00fff7 inset;
        }
        
        .cyber-remove-btn {
            background: linear-gradient(90deg, #ff4444 0%, #ff8800 100%);
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8em;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            letter-spacing: 0.3px;
            transition: background 0.2s, box-shadow 0.2s;
            min-height: 44px;
        }
        
        .cyber-remove-btn:hover {
            background: linear-gradient(90deg, #ff8800 0%, #ff4444 100%);
            box-shadow: 0 0 12px #ff4444;
        }
        
        .cyber-error-message {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 12px;
            font-size: 0.9em;
            text-align: center;
            display: none;
        }
        
        .github-answer-card {
            background: rgba(15,32,39,0.95);
            border: 2px solid #00fff7;
            border-radius: 10px;
            box-shadow: 0 0 12px #00fff7, 0 0 6px #39ff14 inset;
            padding: 15px;
            margin-bottom: 12px;
            color: #39ff14;
            word-wrap: break-word;
        }
        
        .github-answer-card strong, .github-answer-card b {
            color: #39ff14;
        }
        
        .github-answer-card code {
            background: #222b36;
            color: #ffe082;
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 0.9em;
            word-break: break-all;
        }
        
        .github-answer-card pre {
            background: #222b36;
            color: #ffe082;
            padding: 8px 10px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .github-answer-card ul, .github-answer-card ol {
            margin: 8px 0 8px 20px;
            padding-left: 15px;
        }
        
        .github-answer-card li {
            margin-bottom: 4px;
        }
        
        .github-answer-card .show-more {
            color: #00fff7;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 6px;
            font-weight: bold;
        }
        
        .github-answer-card .show-more:hover {
            color: #39ff14;
        }
        
        /* Performance Analysis Styles */
        .cyber-section {
            background: rgba(15,32,39,0.8);
            border: 1px solid #39ff14;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .cyber-input {
            width: 100%;
            background: #0f2027;
            color: #39ff14;
            border: 2px solid #39ff14;
            border-radius: 6px;
            font-size: 0.9em;
            font-family: 'Fira Mono', 'Courier New', monospace;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 0 6px #00fff7 inset;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
        }
        
        .cyber-input:focus {
            border: 2px solid #00fff7;
            box-shadow: 0 0 10px #39ff14, 0 0 5px #00fff7 inset;
        }
        
        .github-question-btn {
            background: linear-gradient(90deg, #39ff14 0%, #00fff7 100%);
            color: #0f2027;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8em;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            padding: 8px 10px;
            cursor: pointer;
            letter-spacing: 0.3px;
            text-shadow: 0 0 3px #fff;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            min-height: 44px;
            margin: 2px;
        }
        
        .github-question-btn:hover {
            background: linear-gradient(90deg, #00fff7 0%, #39ff14 100%);
            color: #0f2027;
            box-shadow: 0 0 12px #00fff7, 0 0 6px #39ff14 inset;
        }
        
        /* GitHub questions grid */
        #github-questions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        /* Fix Suggestion Styles */
        .fix-suggestion {
            background: rgba(15, 32, 39, 0.8);
            border: 1px solid #00fff7;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            box-shadow: 0 0 6px rgba(0, 255, 247, 0.2);
        }
        
        .fix-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .fix-header h4 {
            color: #39ff14;
            margin: 0;
            font-size: 1em;
        }
        
        .fix-severity {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.7em;
            font-weight: bold;
            align-self: flex-start;
        }
        
        .fix-severity.critical {
            background: #ff4444;
            color: white;
        }
        
        .fix-severity.high {
            background: #ff8800;
            color: white;
        }
        
        .fix-severity.medium {
            background: #ffaa00;
            color: black;
        }
        
        .fix-severity.low {
            background: #00aa00;
            color: white;
        }
        
        .fix-confidence {
            color: #00fff7;
            font-size: 0.8em;
        }
        
        .fix-description {
            color: #39ff14;
            margin-bottom: 6px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .fix-explanation {
            color: #00fff7;
            margin-bottom: 12px;
            font-size: 0.85em;
            line-height: 1.3;
        }
        
        .fix-plain-explanation {
            color: #00fff7;
            margin-bottom: 12px;
            font-size: 0.85em;
            line-height: 1.3;
        }
        
        .plain-expl-label {
            font-weight: bold;
        }
        
        .plain-expl-text {
            margin-bottom: 6px;
        }
        
        .plain-expl-ellipsis {
            font-weight: bold;
        }
        
        .plain-expl-more {
            display: none;
        }
        
        .learn-more-link {
            color: #00fff7;
            text-decoration: underline;
        }
        
        .fix-code-diff {
            background: rgba(10, 20, 30, 0.9);
            border: 1px solid #39ff14;
            border-radius: 5px;
            margin-bottom: 12px;
        }
        
        .diff-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            background: rgba(57, 255, 20, 0.1);
            padding: 6px 10px;
            border-bottom: 1px solid #39ff14;
        }
        
        .diff-header span {
            color: #39ff14;
            font-weight: bold;
            text-align: center;
            font-size: 0.8em;
        }
        
        .diff-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1px;
        }
        
        .original-code, .fixed-code {
            background: rgba(10, 20, 30, 0.9);
            color: #39ff14;
            padding: 10px;
            margin: 0;
            font-family: 'Fira Mono', 'Courier New', monospace;
            font-size: 0.8em;
            line-height: 1.3;
            max-height: 150px;
            overflow: auto;
            border: none;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .original-code {
            border-bottom: 1px solid #39ff14;
        }
        
        .fix-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .cyber-btn-small {
            padding: 8px 10px;
            background: linear-gradient(90deg, #39ff14 0%, #00fff7 100%);
            color: #0f2027;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8em;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 0.3px;
            text-shadow: 0 0 3px #fff;
            transition: background 0.2s, box-shadow 0.2s;
            min-height: 44px;
        }
        
        .cyber-btn-small:hover {
            background: linear-gradient(90deg, #00fff7 0%, #39ff14 100%);
            box-shadow: 0 0 10px #00fff7;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(57, 255, 20, 0.3);
            border-radius: 50%;
            border-top-color: #39ff14;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile navigation styles */
        @media (max-width: 767px) {
            .mobile-nav-toggle {
                display: flex;
                z-index: 1001;
                padding: 6px;
                margin-bottom: 10px;
                width: 36px;
                height: 36px;
            }
            .cyber-tabs {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 56px;
                left: 0;
                right: 0;
                width: 100vw;
                background: rgba(10, 20, 30, 0.98);
                border-bottom: 2px solid #39ff14;
                border-radius: 0 0 10px 10px;
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(57, 255, 20, 0.3);
                padding: 8px 0;
            }
            .cyber-tabs.show {
                display: flex;
            }
            .cyber-tab {
                width: 100%;
                text-align: left;
                padding: 10px 16px;
                font-size: 1em;
                border-bottom: 1px solid rgba(57,255,20,0.1);
                color: #7fffd4;
                background: none;
                border-radius: 0;
            }
            .cyber-tab:last-child {
                border-bottom: none;
            }
            .mobile-nav-toggle span {
                width: 20px;
                height: 2.5px;
                margin: 2.5px 0;
            }
            .mobile-nav-toggle.active span:nth-child(1) {
                transform: rotate(-45deg) translate(-4px, 5px);
            }
            .mobile-nav-toggle.active span:nth-child(3) {
                transform: rotate(45deg) translate(-4px, -5px);
            }
        }
        
        /* Tablet styles */
        @media (min-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .cyber-container {
                max-width: 900px;
                margin: 40px auto;
                padding: 40px 32px 32px 32px;
                border-radius: 18px;
            }
            
            .cyber-header h1 {
                font-size: 2.8em;
            }
            
            .cyber-header p {
                font-size: 1.2em;
            }
            
            .cyber-tabs {
                display: flex;
                flex-wrap: nowrap;
                justify-content: space-between; /* Evenly distribute tabs */
                align-items: center;
                gap: 0;
                width: 100%;
            }
            
            .cyber-tab {
                flex: 1 1 0;
                text-align: center;
                padding: 16px 0;
                font-size: 1.1em;
                background: none;
                border: none;
                color: #7fffd4; /* Subtle default color */
                transition: color 0.2s, background 0.2s, box-shadow 0.2s;
                position: relative;
                z-index: 1;
            }
            
            .cyber-tab.active {
                color: #00fff7; /* Subtle highlight for active tab */
                background: none;
                box-shadow: none;
            }
            
            .cyber-tab:hover, .cyber-tab:focus {
                color: #39ff14; /* Neon only on hover/focus */
                background: rgba(57,255,20,0.08);
                z-index: 2;
            }
            
            .cyber-btn-group {
                flex-direction: row;
                gap: 16px;
            }
            
            .cyber-btn {
                padding: 14px 0;
                font-size: 1.1em;
            }
            
            .cyber-textarea {
                min-height: 160px;
                font-size: 1.1em;
                padding: 16px;
            }
            
            .cyber-result-card {
                padding: 24px;
                margin-bottom: 24px;
            }
            
            .cyber-result-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 0;
            }
            
            .cyber-quality-score {
                padding: 8px 18px;
                font-size: 1.1em;
            }
            
            .cyber-model-name {
                font-size: 1.1em;
            }
            
            .cyber-section-title {
                font-size: 1.2em;
                margin-top: 18px;
            }
            
            .cyber-section-content {
                font-size: 1.05em;
            }
            
            .cyber-upload-zone {
                padding: 40px 20px;
            }
            
            .cyber-upload-icon {
                font-size: 3em;
            }
            
            .cyber-upload-text {
                font-size: 1.2em;
            }
            
            .cyber-image-preview {
                max-height: 300px;
            }
            
            .cyber-prompt-input {
                min-height: 80px;
                font-size: 1em;
                padding: 12px;
            }
            
            .cyber-input {
                font-size: 1em;
                padding: 12px;
            }
            
            .cyber-section {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .fix-suggestion {
                padding: 16px;
                margin: 12px 0;
            }
            
            .fix-header {
                flex-direction: row;
                align-items: center;
                gap: 12px;
            }
            
            .fix-header h4 {
                font-size: 1.1em;
            }
            
            .fix-severity {
                padding: 4px 8px;
                font-size: 0.8em;
            }
            
            .fix-description {
                font-size: 0.95em;
            }
            
            .fix-explanation {
                font-size: 0.95em;
            }
            
            .fix-plain-explanation {
                font-size: 0.95em;
            }
            
            .diff-content {
                grid-template-columns: 1fr 1fr;
            }
            
            .original-code {
                border-right: 1px solid #39ff14;
                border-bottom: none;
                max-height: 200px;
                font-size: 0.9em;
                padding: 12px;
            }
            
            .fixed-code {
                max-height: 200px;
                font-size: 0.9em;
                padding: 12px;
            }
            
            .fix-actions {
                flex-direction: row;
                gap: 8px;
            }
            
            .cyber-btn-small {
                padding: 6px 12px;
                font-size: 0.9em;
            }
            
            .github-question-btn {
                font-size: 0.9em;
                padding: 8px 12px;
            }
            
            #github-questions {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }
            
            .analysis-mode-group {
                padding: 15px;
            }
            
            .analysis-mode-group label {
                display: inline-block;
                margin-right: 20px;
                margin-bottom: 0;
                font-size: 1em;
            }
        }
        
        /* Desktop styles */
        @media (min-width: 1024px) {
            .cyber-container {
                padding: 50px 40px 40px 40px;
            }
            
            .cyber-header h1 {
                font-size: 3.2em;
            }
            
            .cyber-header p {
                font-size: 1.4em;
            }
            
            .cyber-tab {
                padding: 20px 0;
                font-size: 1.2em;
            }
            
            .cyber-btn {
                padding: 16px 0;
                font-size: 1.2em;
            }
            
            .cyber-textarea {
                min-height: 200px;
                font-size: 1.2em;
                padding: 20px;
            }
            
            .cyber-result-card {
                padding: 30px;
                margin-bottom: 30px;
            }
            
            .cyber-quality-score {
                padding: 10px 20px;
                font-size: 1.2em;
            }
            
            .cyber-model-name {
                font-size: 1.2em;
            }
            
            .cyber-section-title {
                font-size: 1.3em;
                margin-top: 20px;
            }
            
            .cyber-section-content {
                font-size: 1.1em;
            }
        }
        
        /* Landscape mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            .cyber-container {
                margin: 5px;
                padding: 15px 10px;
            }
            
            .cyber-header {
                margin-bottom: 15px;
            }
            
            .cyber-header h1 {
                font-size: 1.5em;
            }
            
            .cyber-header p {
                font-size: 0.9em;
            }
            
            .cyber-tabs {
                margin-bottom: 15px;
            }
            
            .cyber-tab {
                padding: 8px 4px;
                font-size: 0.8em;
            }
            
            .cyber-textarea {
                min-height: 80px;
            }
            
            .cyber-btn {
                padding: 10px 6px;
                font-size: 0.8em;
            }
        }
        
        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .cyber-container {
                border-width: 1px;
            }
            
            .cyber-textarea, .cyber-input, .cyber-prompt-input {
                border-width: 1px;
            }
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            /* Already dark theme, no changes needed */
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .cyber-container {
                box-shadow: none;
                border: 1px solid #ccc;
                background: white;
            }
            
            .cyber-btn, .cyber-tab {
                display: none;
            }
        }
        
        /* Mobile-specific enhancements */
        .touch-active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }
        
        .loading {
            position: relative;
            opacity: 0.7;
        }
        
        .loading .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(57, 255, 20, 0.3);
            border-radius: 50%;
            border-top-color: #39ff14;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        .scrolling {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Mobile-specific button states */
        .cyber-btn:active, .cyber-tab:active, .github-question-btn:active {
            transform: scale(0.98);
            transition: transform 0.1s ease;
        }
        
        /* Mobile-specific input focus */
        .cyber-textarea:focus, .cyber-input:focus, .cyber-prompt-input:focus {
            -webkit-appearance: none;
            border-radius: 6px;
        }
        
        /* Mobile-specific scrollbar */
        .cyber-result-card::-webkit-scrollbar,
        .github-answer-card::-webkit-scrollbar {
            width: 6px;
        }
        
        .cyber-result-card::-webkit-scrollbar-thumb,
        .github-answer-card::-webkit-scrollbar-thumb {
            background: #00fff7;
            border-radius: 3px;
        }
        
        /* Mobile-specific text selection */
        ::selection {
            background: rgba(57, 255, 20, 0.3);
            color: #39ff14;
        }
        
        ::-moz-selection {
            background: rgba(57, 255, 20, 0.3);
            color: #39ff14;
        }
        
        /* Mobile-specific focus indicators */
        .cyber-btn:focus, .cyber-tab:focus, .github-question-btn:focus {
            outline: 2px solid #39ff14;
            outline-offset: 2px;
        }
        
        /* Mobile-specific disabled state */
        .cyber-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* Mobile Floating Action Button */
        .mobile-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
        
        .fab-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(90deg, #39ff14 0%, #00fff7 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #0f2027;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(57, 255, 20, 0.4);
            transition: all 0.3s ease;
            border: 2px solid #39ff14;
        }
        
        .fab-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(57, 255, 20, 0.6);
        }
        
        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: rgba(10, 20, 30, 0.95);
            border: 2px solid #39ff14;
            border-radius: 12px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            box-shadow: 0 4px 20px rgba(57, 255, 20, 0.3);
        }
        
        .mobile-fab.active .fab-menu {
            display: flex;
        }
        
        .fab-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: none;
            border: none;
            color: #39ff14;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            text-align: left;
            min-height: 44px;
        }
        
        .fab-item:hover {
            background: rgba(57, 255, 20, 0.1);
            color: #00fff7;
        }
        
        .fab-icon-small {
            font-size: 1.2em;
        }
        
        .fab-label {
            font-weight: bold;
        }
        
        /* Show FAB only on mobile */
        @media (max-width: 767px) {
            .mobile-fab {
                display: block;
            }
        }
    </style>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="cyber-container">
        <div class="cyber-header">
            <h1>ðŸ¤– LLM Code Analyzer</h1>
            <p>Advanced AI-powered code analysis with RAG capabilities</p>
        </div>
        <div id="cyber-error" class="cyber-error-message"></div>
        <div class="mobile-nav-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="cyber-tabs" id="cyber-tabs">
            <button class="cyber-tab active" data-tab="analysis">Code Analysis</button>
            <button class="cyber-tab" data-tab="performance">Performance</button>
            <button class="cyber-tab" data-tab="github">GitHub</button>
            <button class="cyber-tab" data-tab="multimodal">Multi-Modal</button>
            <button class="cyber-tab" data-tab="search">Search</button>
            <button class="cyber-tab" data-tab="stats">Stats</button>
        </div>
        <div class="cyber-content active" id="tab-analysis">
            <label class="cyber-label" for="cyber-code">Enter your code:</label>
            <textarea class="cyber-textarea" id="cyber-code" placeholder="Paste your code here..."></textarea>
            <div class="cyber-btn-group">
                <button class="cyber-btn" id="analyze-deepseek">Analyze with DeepSeek</button>
                <button class="cyber-btn" id="analyze-claude">Analyze with Claude</button>
                <button class="cyber-btn" id="analyze-mercury">Analyze with Mercury</button>
                <button class="cyber-btn" id="analyze-all">Analyze with All Models</button>
            </div>
            <div class="analysis-mode-group">
                <label style="color:#00fff7; font-size:1em; margin-bottom:8px; display:block;">Analysis Mode:</label>
                <label><input type="radio" name="analysis-mode" value="quick" checked> Quick (Faster, Concise)</label>
                <label><input type="radio" name="analysis-mode" value="thorough"> Thorough (Full, Detailed)</label>
            </div>
            <div class="cyber-results" id="cyber-results"></div>
        </div>
        <div class="cyber-content" id="tab-performance">
            <label class="cyber-label">Enter your code for performance analysis:</label>
            <textarea class="cyber-textarea" id="performanceCodeInput" placeholder="Paste your code here for performance profiling..."></textarea>
            
            <div class="cyber-btn-group">
                <button class="cyber-btn" onclick="analyzePerformance()">Analyze Performance</button>
                <button class="cyber-btn" onclick="profileFunction()">Profile Function</button>
                <button class="cyber-btn" onclick="benchmarkAlternatives()">Benchmark Alternatives</button>
            </div>
            
            <!-- Function Profiling Section -->
            <div class="cyber-section" id="functionProfiling" style="display: none;">
                <label class="cyber-label">Function Name:</label>
                <input type="text" id="functionName" class="cyber-input" placeholder="e.g., my_function">
                
                <label class="cyber-label">Test Inputs (JSON array):</label>
                <textarea class="cyber-textarea" id="testInputs" placeholder='[1, 2, 3] or [{"param1": "value1"}]' style="min-height: 80px;"></textarea>
            </div>
            
            <!-- Benchmark Section -->
            <div class="cyber-section" id="benchmarkSection" style="display: none;">
                <label class="cyber-label">Code Versions (JSON array):</label>
                <textarea class="cyber-textarea" id="codeVersions" placeholder='[{"name": "version1", "code": "def func(): pass", "function_name": "func"}]' style="min-height: 120px;"></textarea>
                
                <label class="cyber-label">Test Inputs (JSON array):</label>
                <textarea class="cyber-textarea" id="benchmarkInputs" placeholder='[1, 2, 3]' style="min-height: 80px;"></textarea>
            </div>
            
            <div class="cyber-results" id="performanceResults"></div>
        </div>
        <div class="cyber-content" id="tab-github">
            <label class="cyber-label" for="github-url">GitHub URL:</label>
            <input type="text" class="cyber-textarea" id="github-url" placeholder="Paste GitHub link here... (e.g., https://github.com/owner/repo/blob/main/file.py)" style="min-height:40px;">
            
            <label class="cyber-label" for="github-prompt">Analysis Prompt (Optional):</label>
            <textarea class="cyber-prompt-input" id="github-prompt" placeholder="Describe what you want me to analyze... (e.g., 'Analyze the code quality', 'Explain the architecture', 'Find potential issues')"></textarea>
            
            <div class="cyber-btn-group">
                <button class="cyber-btn" id="analyze-github-deepseek">Analyze with DeepSeek</button>
                <button class="cyber-btn" id="analyze-github-claude">Analyze with Claude</button>
                <button class="cyber-btn" id="analyze-github-mercury">Analyze with Mercury</button>
                <button class="cyber-btn" id="analyze-github-all">Analyze with All Models</button>
            </div>
            
            <div class="cyber-results" id="cyber-github-results"></div>

            <div style="margin-top:20px;">
                <div class="cyber-label">Ask About This Repo:</div>
                <div id="github-questions">
                    <button class="cyber-btn github-question-btn" data-question="What does this repo do?">What does this repo do?</button>
                    <button class="cyber-btn github-question-btn" data-question="How do I install and use it?">How do I install and use it?</button>
                    <button class="cyber-btn github-question-btn" data-question="What are its main features?">What are its main features?</button>
                    <button class="cyber-btn github-question-btn" data-question="What are some use cases?">What are some use cases?</button>
                    <button class="cyber-btn github-question-btn" data-question="How does the main algorithm work?">How does the main algorithm work?</button>
                    <button class="cyber-btn github-question-btn" data-question="What are the limitations?">What are the limitations?</button>
                    <button class="cyber-btn github-question-btn" data-question="How can I contribute?">How can I contribute?</button>
                    <button class="cyber-btn github-question-btn" data-question="Is it production ready?">Is it production ready?</button>
                    <button class="cyber-btn github-question-btn" data-question="What license does it use?">What license does it use?</button>
                    <button class="cyber-btn github-question-btn" data-question="What are the security risks?">What are the security risks?</button>
                </div>
                <div class="cyber-results" id="github-chat-result"></div>
            </div>
        </div>
        <div class="cyber-content" id="tab-multimodal">
            <label class="cyber-label">Upload Image for Analysis:</label>
            <div class="cyber-upload-zone" id="upload-zone" tabindex="0" role="button" style="z-index:10; position:relative;">
                <div class="cyber-upload-icon">ðŸ“·</div>
                <div class="cyber-upload-text">Click to upload or drag & drop</div>
                <div class="cyber-upload-hint">Supports: PNG, JPG, JPEG (Max 10MB)</div>
                <input type="file" id="image-input" accept="image/*" style="display: none;" tabindex="-1">
            </div>
            
            <div id="image-preview-container" style="display: none;">
                <img id="image-preview" class="cyber-image-preview">
                <div class="cyber-image-info" id="image-info"></div>
                <button class="cyber-remove-btn" id="remove-image">Remove Image</button>
            </div>
            
            <label class="cyber-label" for="analysis-prompt">Analysis Prompt (Optional):</label>
            <textarea class="cyber-prompt-input" id="analysis-prompt" placeholder="Describe what you want me to analyze in this image... (e.g., 'Analyze the code in this screenshot', 'Explain this UML diagram', 'Review this UI mockup')"></textarea>
            
            <div class="cyber-btn-group">
                <button class="cyber-btn" id="analyze-image-gemini">Analyze with Gemini Vision</button>
                <button class="cyber-btn" id="analyze-image-claude">Analyze with Claude 3.5</button>
                <button class="cyber-btn" id="analyze-image-all">Analyze with All Models</button>
            </div>
            
            <div class="cyber-results" id="cyber-multimodal-results"></div>
        </div>
        <div class="cyber-content" id="tab-search">
            <label class="cyber-label" for="cyber-search">Search codebase:</label>
            <input class="cyber-textarea" id="cyber-search" placeholder="Enter search query..." style="min-height:40px;">
            <button class="cyber-btn" id="search-btn" style="margin-top:12px;">Search</button>
            <div class="cyber-results" id="cyber-search-results"></div>
        </div>
        <div class="cyber-content" id="tab-stats">
            <button class="cyber-btn" id="refresh-stats">Refresh Stats</button>
            <div class="cyber-results" id="cyber-stats-results"></div>
        </div>
    </div>

    <script>
        // Tab switching
        $(document).on('click', '.cyber-tab', function() {
            $('.cyber-tab').removeClass('active');
            $(this).addClass('active');
            $('.cyber-content').removeClass('active');
            $('#tab-' + $(this).data('tab')).addClass('active');
        });
        // Analyze buttons
        function renderResult(model, result) {
            lastAnalysisResult = result;
            lastModel = model;
            // Language/framework display
            let langHtml = '';
            if (result.detected_language) {
                langHtml += `<div class='cyber-section-title'>Detected Language: <span class='detected-language'>${result.detected_language}</span></div>`;
                if (result.detected_frameworks && result.detected_frameworks.length > 0) {
                    langHtml += `<div class='cyber-section-content'>Frameworks: ${result.detected_frameworks.map(fw => `<span class='detected-framework'>${fw}</span>`).join(', ')}</div>`;
                }
                langHtml += `<div class='cyber-section-content'><label for='language-override'>Override Language: </label><select id='language-override' class='cyber-input' style='margin-left:8px;'>`;
                SUPPORTED_LANGUAGES.forEach(lang => {
                    langHtml += `<option value='${lang.value}' ${result.detected_language === lang.value ? 'selected' : ''}>${lang.label}</option>`;
                });
                langHtml += `</select></div>`;
            }
            // Determine if quick or thorough mode (guess from fix_suggestions or a new field)
            const isQuick = !result.fix_suggestions || result.fix_suggestions.length === 0;
            // Only show headings if content exists in quick mode, always show in thorough
            let html = `<div class='cyber-result-card'>${langHtml}`;
            if (!isQuick || (result.potential_bugs && result.potential_bugs.length > 0)) {
                html += `<div class='cyber-section-title'>Potential Bugs</div>`;
                if (result.potential_bugs && result.potential_bugs.length > 0) {
                    html += `<ul class='cyber-section-content'>${result.potential_bugs.map(bug => `<li>${bug}</li>`).join('')}</ul>`;
                }
            }
            if (!isQuick || (result.improvement_suggestions && result.improvement_suggestions.length > 0)) {
                html += `<div class='cyber-section-title'>Improvement Suggestions</div>`;
                if (result.improvement_suggestions && result.improvement_suggestions.length > 0) {
                    html += `<ul class='cyber-section-content'>${result.improvement_suggestions.map(s => `<li>${s}</li>`).join('')}</ul>`;
                }
            }
            // Fix suggestions (thorough mode only)
            if (result.fix_suggestions && result.fix_suggestions.length > 0) {
                html += `<div class='cyber-section-title'>ðŸ”§ Interactive Fix Suggestions</div>`;
                html += `<div class='cyber-section-content'>`;
                result.fix_suggestions.forEach((fix, index) => {
                    html += `
                        <div class='fix-suggestion' data-fix-index='${index}'>
                            <div class='fix-header'>
                                <h4>${fix.title || 'Code Fix'}</h4>
                                <span class='fix-severity ${fix.severity}'>${fix.severity.toUpperCase()}</span>
                                <span class='fix-confidence'>${Math.round(fix.confidence * 100)}% confidence</span>
                            </div>
                            <div class='fix-description'>${fix.description}</div>
                            <div class='fix-explanation'>${fix.explanation}</div>
                            <div class='fix-plain-explanation'>
                                <div class='plain-expl-label'>Why this matters:</div>
                                <div class='plain-expl-text' id='plain-expl-${index}'>
                                    ${(fix.plain_explanation || '').length > 180 ?
                                        `${(fix.plain_explanation || '').slice(0, 180)}<span class='plain-expl-ellipsis'>... </span><a href='#' class='show-more-link' data-index='${index}'>Show more</a><span class='plain-expl-more' style='display:none;'>${(fix.plain_explanation || '').slice(180)}</span>`
                                        : (fix.plain_explanation || 'No plain explanation available.')}
                                </div>
                                ${fix.learn_more_link ? `<a href='${fix.learn_more_link}' target='_blank' class='learn-more-link'>Learn More</a>` : ''}
                            </div>
                            <div class='fix-code-diff'>
                                <div class='diff-header'>
                                    <span>Before</span>
                                    <span>After</span>
                                </div>
                                <div class='diff-content'>
                                    <pre class='original-code'>${fix.original_code}</pre>
                                    <pre class='fixed-code'>${fix.fixed_code}</pre>
                                </div>
                            </div>
                            <div class='fix-actions'>
                                <button class='cyber-btn-small' onclick='previewFix(${index})'>ðŸ‘ï¸ Preview</button>
                                <button class='cyber-btn-small' onclick='copyFix(${index})'>ðŸ“‹ Copy</button>
                                ${fix.can_auto_apply ? `<button class='cyber-btn-small apply-btn' onclick='applyFix(${index})'>âœ… Apply</button>` : ''}
                            </div>
                            ${fix.related_links && fix.related_links.length > 0 ? `
                                <div class='fix-links'>
                                    <strong>Learn more:</strong>
                                    ${fix.related_links.map(link => `<a href='${link}' target='_blank' class='fix-link'>ðŸ“š ${link.split('/').pop()}</a>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                html += `</div>`;
            }
            // Documentation section: vertical scrollable div, word wrap, no horizontal scroll
            if (!isQuick || (result.documentation && result.documentation.trim().length > 0)) {
                html += `<div class='cyber-section-title'>Documentation</div>`;
                html += `<div class='cyber-section-content' style='background:#101c24; color:#39ff14; border-radius:8px; padding:12px; max-height:300px; overflow-y:auto; white-space:pre-wrap; word-break:break-word;'>${result.documentation || 'No documentation generated.'}</div>`;
                // Language mismatch warning
                if (result.detected_language && result.documentation) {
                    const docFirstLine = result.documentation.split(/\n|\r/)[0].toLowerCase();
                    const lang = result.detected_language.toLowerCase();
                    if ((lang.includes('python') && docFirstLine.includes('javascript')) ||
                        (lang.includes('javascript') && docFirstLine.includes('python')) ||
                        (lang.includes('typescript') && docFirstLine.includes('python')) ||
                        (lang.includes('python') && docFirstLine.includes('typescript')) ||
                        (lang.includes('java') && docFirstLine.includes('python')) ||
                        (lang.includes('python') && docFirstLine.includes('java'))) {
                        html += `<div style='background: #ffb300; color: #222; border-radius: 6px; padding: 8px 14px; margin-top: 10px; font-weight: bold;'>âš ï¸ Warning: The documentation appears to describe a different language than detected (${result.detected_language}).</div>`;
                    }
                }
            }
            html += `</div>`;
            return html;
        }
        function analyze(model) {
            const code = $('#cyber-code').val();
            if(!code.trim()) {
                $('#cyber-results').html('<div class="cyber-result-card">Please enter some code.</div>');
                return;
            }
            const mode = $('input[name="analysis-mode"]:checked').val() || 'quick';
            $('#cyber-results').html('<div class="cyber-result-card">Analyzing with ' + model + '...</div>');
            $.ajax({
                url: '/analyze',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ code: code, model: model, mode: mode }),
                success: function(result) {
                    $('#cyber-results').html(renderResult(model, result));
                },
                error: function(xhr) {
                    $('#cyber-results').html(renderResult(model, xhr.responseJSON || {error: 'Unknown error'}));
                }
            });
        }
        $('#analyze-deepseek').click(function() { analyze('deepseek'); });
        $('#analyze-claude').click(function() { analyze('claude'); });
        $('#analyze-mercury').click(function() { analyze('mercury'); });
        $('#analyze-all').click(function() {
            const code = $('#cyber-code').val();
            if(!code.trim()) {
                $('#cyber-results').html('<div class="cyber-result-card">Please enter some code.</div>');
                return;
            }
            const mode = $('input[name="analysis-mode"]:checked').val() || 'quick';
            $('#cyber-results').html('<div class="cyber-result-card">Analyzing with all models...</div>');
            $.ajax({
                url: '/analyze_all',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ code: code, mode: mode }),
                success: function(results) {
                    let html = '';
                    for(const model in results) {
                        html += renderResult(model, results[model]);
                    }
                    $('#cyber-results').html(html);
                },
                error: function(xhr) {
                    $('#cyber-results').html(renderResult('all', xhr.responseJSON || {error: 'Unknown error'}));
                }
            });
        });
        // Code Search
        $('#search-btn').click(function() {
            const query = $('#cyber-search').val();
            if(!query.trim()) {
                $('#cyber-search-results').html('<div class="cyber-result-card">Please enter a search query.</div>');
                return;
            }
            $('#cyber-search-results').html('<div class="cyber-result-card">Searching...</div>');
            $.ajax({
                url: '/search',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ query: query }),
                success: function(result) {
                    if(result.error) {
                        $('#cyber-search-results').html('<div class="cyber-result-card">Error: ' + result.error + '</div>');
                        return;
                    }
                    let html = `<div class='cyber-result-card'><b>Results for:</b> ${result.query}<br><b>Total:</b> ${result.total_results}</div>`;
                    for(const r of result.results) {
                        if (typeof r === 'object' && r !== null) {
                            html += `<div class='cyber-result-card'>` +
                                (r.file_path ? `<b>File:</b> ${r.file_path}<br>` : '') +
                                (r.language ? `<b>Language:</b> ${r.language}<br>` : '') +
                                (r.function_name ? `<b>Function:</b> ${r.function_name}<br>` : '') +
                                (r.class_name ? `<b>Class:</b> ${r.class_name}<br>` : '') +
                                (r.relevance_score !== undefined ? `<b>Relevance:</b> ${(r.relevance_score * 100).toFixed(1)}%<br>` : '') +
                                (r.explanation ? `<b>Explanation:</b> ${r.explanation}<br>` : '') +
                                (r.code ? `<pre>${r.code}</pre>` : '') +
                                `</div>`;
                        } else {
                            html += `<div class='cyber-result-card'><pre>${r}</pre></div>`;
                        }
                    }
                    $('#cyber-search-results').html(html);
                },
                error: function(xhr) {
                    $('#cyber-search-results').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON?.error || 'Unknown error') + '</div>');
                }
            });
        });
        // Codebase Stats
        $('#refresh-stats').click(function() {
            $('#cyber-stats-results').html('<div class="cyber-result-card">Loading stats...</div>');
            $.ajax({
                url: '/stats',
                method: 'GET',
                success: function(stats) {
                    let html = '<div class="cyber-result-card"><b>Codebase Stats</b><br>';
                    for(const key in stats) {
                        html += `<b>${key}:</b> ${stats[key]}<br>`;
                    }
                    html += '</div>';
                    $('#cyber-stats-results').html(html);
                },
                error: function(xhr) {
                    $('#cyber-stats-results').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON?.error || 'Unknown error') + '</div>');
                }
            });
        });
        
        // Multi-Modal Analysis
        let currentImageFile = null;
        
        // File API support check
        $(function() {
            if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                $('#cyber-error').text('Your browser does not fully support file uploads. Please use a modern browser.').show();
            }
        });

        // Auto-activate Multi-Modal Analysis tab on load for easier testing
        $(function() {
            $('.cyber-tab').removeClass('active');
            $('.cyber-content').removeClass('active');
            $('.cyber-tab[data-tab="multimodal"]').addClass('active');
            $('#tab-multimodal').addClass('active');
            $('#tab-multimodal')[0].scrollIntoView({behavior: 'smooth'});
        });

        // --- FIXED FILE UPLOAD HANDLERS ---
        // Only trigger file input when upload zone is clicked
        $('#upload-zone').off('click').on('click', function(e) {
            console.log('Upload zone clicked - opening file picker');
            $('#image-input').trigger('click');
            e.preventDefault();
            e.stopPropagation();
            return false;
        });

        // File input change handler
        $('#image-input').off('change').on('change', function(e) {
            handleImageFile(e.target.files[0]);
        });

        // Drag and drop handlers
        $('#upload-zone').off('dragover').on('dragover', function(e) {
            e.preventDefault();
            $(this).addClass('dragover');
        });
        $('#upload-zone').off('dragleave').on('dragleave', function(e) {
            e.preventDefault();
            $(this).removeClass('dragover');
        });
        $('#upload-zone').off('drop').on('drop', function(e) {
            e.preventDefault();
            $(this).removeClass('dragover');
            const files = e.originalEvent.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        });
        
        function handleImageFile(file) {
            if (!file) return;
            
            console.log('Processing file:', file.name, 'Size:', file.size, 'Type:', file.type);
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file. Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP');
                return;
            }
            
            // Validate file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB. Current size: ' + (file.size / (1024 * 1024)).toFixed(2) + 'MB');
                return;
            }
            
            // Validate file extension
            const allowedExtensions = ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'webp'];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (!allowedExtensions.includes(fileExtension)) {
                alert('Unsupported file format. Please use: ' + allowedExtensions.join(', '));
                return;
            }
            
            currentImageFile = file;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#image-preview').attr('src', e.target.result);
                $('#image-preview-container').show();
                
                // Show file info
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                $('#image-info').html(`
                    <strong>File:</strong> ${file.name}<br>
                    <strong>Size:</strong> ${sizeMB} MB<br>
                    <strong>Type:</strong> ${file.type}<br>
                    <strong>Extension:</strong> ${fileExtension}
                `);
                
                // Clear any previous error messages
                $('#cyber-multimodal-results').html('');
            };
            reader.onerror = function() {
                alert('Error reading file. Please try again.');
            };
            reader.readAsDataURL(file);
        }
        
        $('#remove-image').click(function() {
            currentImageFile = null;
            $('#image-preview-container').hide();
            $('#image-input').val('');
        });
        
        // Image analysis functions
        function analyzeImage(model) {
            if (!currentImageFile) {
                $('#cyber-multimodal-results').html('<div class="cyber-result-card">Please upload an image first.</div>');
                return;
            }
            const prompt = $('#analysis-prompt').val() || 'Analyze this image and provide insights about any code, diagrams, or UI elements you can see.';
            $('#cyber-multimodal-results').html('<div class="cyber-result-card">Analyzing image with ' + model + '...</div>');
            const formData = new FormData();
            formData.append('image', currentImageFile);
            formData.append('prompt', prompt);
            formData.append('model', model);
            $.ajax({
                url: '/analyze_image',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(result) {
                    $('#cyber-multimodal-results').html(renderImageResult(model, result));
                },
                error: function(xhr) {
                    console.error('Analysis error:', xhr);
                    let errorMsg = 'Unknown error occurred';
                    if (xhr.responseJSON && xhr.responseJSON.error) {
                        errorMsg = xhr.responseJSON.error;
                    } else if (xhr.status === 0) {
                        errorMsg = 'Network error - please check your connection';
                    } else if (xhr.status === 500) {
                        errorMsg = 'Server error - please check the console for details';
                    } else if (xhr.status === 400) {
                        errorMsg = 'Bad request - please check your file and try again';
                    }
                    $('#cyber-multimodal-results').html(renderImageResult(model, {error: errorMsg}));
                }
            });
        }
        
        function renderImageResult(model, result) {
            if(result.error) {
                return `<div class='cyber-result-card'><b>Error:</b> ${result.error}</div>`;
            }
            // Format analysis as bullet points if possible
            let analysisHtml = '';
            if (result.analysis) {
                // Try to split into points by lines or dashes
                let lines = result.analysis.split(/\n|\r|\u2022|\-/).map(l => l.trim()).filter(l => l.length > 0);
                if (lines.length > 1) {
                    analysisHtml = '<ul>' + lines.map(l => `<li>${l}</li>`).join('') + '</ul>';
                } else {
                    analysisHtml = `<div>${result.analysis}</div>`;
                }
            } else {
                analysisHtml = 'No analysis available.';
            }
            let suggestionsHtml = '';
            if (result.suggestions && result.suggestions.length > 0) {
                suggestionsHtml = '<ul>' + result.suggestions.map(s => `<li>${s}</li>`).join('') + '</ul>';
            }
            return `<div class='cyber-result-card'>
                <div class='cyber-result-header'>
                    <span class='cyber-model-name'>${model}</span>
                    <span class='cyber-execution-time'>${result.execution_time ? 'â± ' + result.execution_time + 's' : ''}</span>
                </div>
                <div class='cyber-section-title'>Analysis</div>
                <div class='cyber-section-content'>${analysisHtml}</div>
                ${result.code_extracted ? `<div class='cyber-section-title'>Extracted Code</div><pre class='cyber-section-content' style='background:#101c24; color:#39ff14; border-radius:8px; padding:12px; max-height:300px; overflow:auto;'>${result.code_extracted}</pre>` : ''}
                ${suggestionsHtml ? `<div class='cyber-section-title'>Suggestions</div><div class='cyber-section-content'>${suggestionsHtml}</div>` : ''}
            </div>`;
        }
        
        // --- Button handlers ---
        $('#analyze-image-gemini').click(function() { analyzeImage('gemini-vision'); });
        $('#analyze-image-claude').click(function() { analyzeImage('claude'); });
        $('#analyze-image-all').click(function() {
            if (!currentImageFile) {
                $('#cyber-multimodal-results').html('<div class="cyber-result-card">Please upload an image first.</div>');
                return;
            }
            const prompt = $('#analysis-prompt').val() || 'Analyze this image and provide insights about any code, diagrams, or UI elements you can see.';
            $('#cyber-multimodal-results').html('<div class="cyber-result-card">Analyzing image with all models...</div>');
            const formData = new FormData();
            formData.append('image', currentImageFile);
            formData.append('prompt', prompt);
            $.ajax({
                url: '/analyze_image_all',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(results) {
                    let html = '';
                    for(const model in results) {
                        html += renderImageResult(model, results[model]);
                    }
                    $('#cyber-multimodal-results').html(html);
                },
                error: function(xhr) {
                    $('#cyber-multimodal-results').html(renderImageResult('all', xhr.responseJSON || {error: 'Unknown error'}));
                }
            });
        });
        
        // GitHub Analysis Functions
        function analyzeGitHub(model) {
            const githubUrl = $('#github-url').val().trim();
            if (!githubUrl) {
                $('#cyber-github-results').html('<div class="cyber-result-card">Please enter a GitHub URL.</div>');
                return;
            }
            
            const prompt = $('#github-prompt').val() || 'Analyze this code and provide a comprehensive explanation.';
            
            $('#cyber-github-results').html('<div class="cyber-result-card">Analyzing GitHub link with ' + model + '...</div>');
            
            $.ajax({
                url: '/analyze_github',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    github_url: githubUrl, 
                    model: model, 
                    prompt: prompt 
                }),
                success: function(result) {
                    $('#cyber-github-results').html(renderGitHubResult(model, result));
                },
                error: function(xhr) {
                    $('#cyber-github-results').html(renderGitHubResult(model, xhr.responseJSON || {error: 'Unknown error'}));
                }
            });
        }
        
        function renderGitHubResult(model, result) {
            if(result.error) {
                return `<div class='cyber-result-card'><b>Error:</b> ${result.error}</div>`;
            }
            
            let fileInfoHtml = '';
            if (result.file_info) {
                const info = result.file_info;
                if (info.file_path) {
                    // Single file
                    fileInfoHtml = `
                        <div class='cyber-section-title'>File Information</div>
                        <div class='cyber-section-content'>
                            <strong>Repository:</strong> ${info.owner}/${info.repo}<br>
                            <strong>Branch:</strong> ${info.branch}<br>
                            <strong>File:</strong> ${info.file_path}<br>
                            <strong>Size:</strong> ${info.file_size} characters, ${info.lines} lines
                        </div>
                    `;
                } else {
                    // Repository
                    fileInfoHtml = `
                        <div class='cyber-section-title'>Repository Information</div>
                        <div class='cyber-section-content'>
                            <strong>Repository:</strong> ${info.owner}/${info.repo}<br>
                            <strong>Branch:</strong> ${info.branch}<br>
                            <strong>Files Analyzed:</strong> ${info.files_analyzed ? info.files_analyzed.length : 0}<br>
                            <strong>Total Files:</strong> ${info.total_files || 'Unknown'}
                        </div>
                    `;
                    
                    if (info.files_analyzed && info.files_analyzed.length > 0) {
                        fileInfoHtml += `
                            <div class='cyber-section-title'>Files Analyzed</div>
                            <ul class='cyber-section-content'>
                                ${info.files_analyzed.map(f => `<li>${f.path} (${f.lines} lines)</li>`).join('')}
                            </ul>
                        `;
                    }
                }
            }
            
            // Format analysis as bullet points if possible
            let analysisHtml = '';
            if (result.analysis) {
                let lines = result.analysis.split(/\n|\r|\u2022|\-/).map(l => l.trim()).filter(l => l.length > 0);
                if (lines.length > 1) {
                    analysisHtml = '<ul>' + lines.map(l => `<li>${l}</li>`).join('') + '</ul>';
                } else {
                    analysisHtml = `<div>${result.analysis}</div>`;
                }
            } else {
                analysisHtml = 'No analysis available.';
            }
            
            let suggestionsHtml = '';
            if (result.suggestions && result.suggestions.length > 0) {
                suggestionsHtml = '<ul>' + result.suggestions.map(s => `<li>${s}</li>`).join('') + '</ul>';
            }
            
            let codeContentHtml = '';
            if (result.code_content && result.code_content.length > 0) {
                // Truncate if too long
                const maxLength = 2000;
                const truncated = result.code_content.length > maxLength ? 
                    result.code_content.substring(0, maxLength) + '... (truncated)' : 
                    result.code_content;
                codeContentHtml = `
                    <div class='cyber-section-title'>Code Content</div>
                    <pre class='cyber-section-content' style='background:#101c24; color:#39ff14; border-radius:8px; padding:12px; max-height:300px; overflow:auto;'>${truncated}</pre>
                `;
            }
            
            return `<div class='cyber-result-card'>
                <div class='cyber-result-header'>
                    <span class='cyber-model-name'>${model}</span>
                    <span class='cyber-quality-score'>Quality: ${result.quality_score ?? 'N/A'}</span>
                    <span class='cyber-execution-time'>${result.execution_time ? 'â± ' + result.execution_time + 's' : ''}</span>
                </div>
                ${fileInfoHtml}
                <div class='cyber-section-title'>Analysis</div>
                <div class='cyber-section-content'>${analysisHtml}</div>
                ${codeContentHtml}
                ${suggestionsHtml ? `<div class='cyber-section-title'>Suggestions</div><div class='cyber-section-content'>${suggestionsHtml}</div>` : ''}
            </div>`;
        }
        
        // GitHub Analysis Button Handlers
        $('#analyze-github-deepseek').click(function() { analyzeGitHub('deepseek'); });
        $('#analyze-github-claude').click(function() { analyzeGitHub('claude'); });
        $('#analyze-github-mercury').click(function() { analyzeGitHub('mercury'); });
        $('#analyze-github-all').click(function() {
            const githubUrl = $('#github-url').val().trim();
            if (!githubUrl) {
                $('#cyber-github-results').html('<div class="cyber-result-card">Please enter a GitHub URL.</div>');
                return;
            }
            
            const prompt = $('#github-prompt').val() || 'Analyze this code and provide a comprehensive explanation.';
            
            $('#cyber-github-results').html('<div class="cyber-result-card">Analyzing GitHub link with all models...</div>');
            
            // Analyze with each model sequentially
            const models = ['deepseek', 'claude', 'mercury'];
            let completed = 0;
            let allResults = {};
            
            models.forEach(model => {
                $.ajax({
                    url: '/analyze_github',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ 
                        github_url: githubUrl, 
                        model: model, 
                        prompt: prompt 
                    }),
                    success: function(result) {
                        allResults[model] = result;
                        completed++;
                        if (completed === models.length) {
                            let html = '';
                            for(const modelName in allResults) {
                                html += renderGitHubResult(modelName, allResults[modelName]);
                            }
                            $('#cyber-github-results').html(html);
                        }
                    },
                    error: function(xhr) {
                        allResults[model] = xhr.responseJSON || {error: 'Unknown error'};
                        completed++;
                        if (completed === models.length) {
                            let html = '';
                            for(const modelName in allResults) {
                                html += renderGitHubResult(modelName, allResults[modelName]);
                            }
                            $('#cyber-github-results').html(html);
                        }
                    }
                });
            });
        });
        
        // Mobile navigation toggle
        $(document).on('click', '.mobile-nav-toggle', function() {
            $(this).toggleClass('active');
            $('.cyber-tabs').toggleClass('show');
        });

        // Close mobile menu when clicking on a tab
        $(document).on('click', '.cyber-tab', function() {
            if ($(window).width() <= 767) {
                $('.mobile-nav-toggle').removeClass('active');
                $('.cyber-tabs').removeClass('show');
            }
        });

        // Reset tab to analysis on load
        $(function() {
            $('.cyber-tab').removeClass('active');
            $('.cyber-content').removeClass('active');
            $('.cyber-tab[data-tab="analysis"]').addClass('active');
            $('#tab-analysis').addClass('active');
        });

        // Add after other $(document).ready or at the end of the main script
        $(document).on('click', '.github-question-btn', function() {
            const githubUrl = $('#github-url').val().trim();
            const question = $(this).data('question');
            if (!githubUrl) {
                $('#github-chat-result').html('<div class="cyber-result-card">Please enter a GitHub repo URL above.</div>');
                return;
            }
            $('#github-chat-result').html('<div class="cyber-result-card">Asking: <b>' + question + '</b> ...</div>');
            $.ajax({
                url: '/ask_github_repo',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ github_url: githubUrl, question: question }),
                success: function(result) {
                    let answer = result.answer || 'No answer.';
                    // Truncate if too long
                    const maxLen = 1200;
                    let truncated = false;
                    if (answer.length > maxLen) {
                        answer = answer.slice(0, maxLen) + '...';
                        truncated = true;
                    }
                    // Render markdown to HTML (basic)
                    answer = renderMarkdown(answer);
                    let html = '<div class="github-answer-card"><b>' + question + '</b><br><br>' + answer;
                    if (truncated) {
                        html += '<div class="show-more">Show more</div>';
                    }
                    html += '</div>';
                    $('#github-chat-result').html(html);
                    // Show more handler
                    $('.show-more').off('click').on('click', function() {
                        let full = renderMarkdown(result.answer || 'No answer.');
                        $(this).parent().html('<b>' + question + '</b><br><br>' + full);
                    });
                },
                error: function(xhr) {
                    $('#github-chat-result').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        });

        // Performance Analysis Functions
        function analyzePerformance() {
            const code = $('#performanceCodeInput').val();
            if (!code.trim()) {
                $('#performanceResults').html('<div class="cyber-result-card">Please enter some code for performance analysis.</div>');
                return;
            }
            
            $('#performanceResults').html('<div class="cyber-result-card">Analyzing performance...</div>');
            
            $.ajax({
                url: '/analyze_advanced',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    code: code, 
                    language: 'python',
                    model: 'deepseek'
                }),
                success: function(result) {
                    renderPerformanceResult(result);
                },
                error: function(xhr) {
                    $('#performanceResults').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        }
        
        function renderPerformanceResult(result) {
            let html = '<div class="cyber-result-card">';
            
            // Performance Analysis Section
            if (result.performance_analysis) {
                const perf = result.performance_analysis;
                html += `
                    <div class="cyber-result-header">
                        <span class="cyber-model-name">Performance Analysis</span>
                        <span class="cyber-quality-score">Score: ${perf.overall_score}/100</span>
                    </div>
                    <div class="cyber-section-title">Summary</div>
                    <div class="cyber-section-content">
                        <ul>
                            <li>Total Issues: ${perf.summary.total_issues}</li>
                            <li>Critical: ${perf.summary.critical}</li>
                            <li>High: ${perf.summary.high}</li>
                            <li>Medium: ${perf.summary.medium}</li>
                            <li>Low: ${perf.summary.low}</li>
                            <li>Overall Complexity: ${perf.summary.overall_complexity}</li>
                        </ul>
                    </div>
                `;
                
                // Performance Issues
                if (perf.issues && perf.issues.length > 0) {
                    html += '<div class="cyber-section-title">Performance Issues</div>';
                    perf.issues.forEach(issue => {
                        const severityColor = {
                            'critical': '#ff4444',
                            'high': '#ff8800',
                            'medium': '#ffaa00',
                            'low': '#00ff00'
                        }[issue.severity] || '#ffffff';
                        
                        html += `
                            <div class="cyber-section-content" style="border-left: 4px solid ${severityColor}; padding-left: 12px; margin-bottom: 12px;">
                                <strong>${issue.type} (${issue.severity.toUpperCase()})</strong><br>
                                <strong>Line ${issue.line_number}:</strong> ${issue.description}<br>
                                <code style="background: #101c24; padding: 4px 8px; border-radius: 4px;">${issue.code_snippet}</code><br>
                                <strong>Impact:</strong> ${issue.impact}<br>
                                <strong>Suggestion:</strong> ${issue.suggestion}
                                ${issue.ai_optimization ? `<br><strong>AI Optimization:</strong><br><pre style="background: #101c24; padding: 8px; border-radius: 4px; margin-top: 8px;">${issue.ai_optimization}</pre>` : ''}
                            </div>
                        `
                    });
                }
            }
            
            // Performance Optimization Suggestions
            if (result.performance_optimizations && result.performance_optimizations.length > 0) {
                html += '<div class="cyber-section-title">Performance Optimizations</div>';
                result.performance_optimizations.forEach(opt => {
                    html += `
                        <div class="cyber-section-content" style="border-left: 4px solid #00ff00; padding-left: 12px; margin-bottom: 12px;">
                            <strong>${opt.type}</strong><br>
                            <strong>Impact:</strong> ${opt.impact}<br>
                            <strong>Implementation:</strong><br>
                            <pre style="background: #101c24; padding: 8px; border-radius: 4px; margin-top: 8px;">${opt.implementation}</pre>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            $('#performanceResults').html(html);
        }
        
        function profileFunction() {
            const code = $('#performanceCodeInput').val();
            const functionName = $('#functionName').val().trim();
            const testInputs = $('#testInputs').val().trim();
            
            if (!code.trim() || !functionName) {
                $('#performanceResults').html('<div class="cyber-result-card">Please enter code and function name for profiling.</div>');
                return;
            }
            
            $('#performanceResults').html('<div class="cyber-result-card">Profiling function...</div>');
            
            $.ajax({
                url: '/profile_function',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    code: code, 
                    function_name: functionName,
                    test_inputs: testInputs
                }),
                success: function(result) {
                    renderProfileResult(result);
                },
                error: function(xhr) {
                    $('#performanceResults').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        }
        
        function renderProfileResult(result) {
            let html = '<div class="cyber-result-card">';
            html += '<div class="cyber-result-header"><span class="cyber-model-name">Function Profile</span></div>';
            
            if (result.profile_data) {
                const profile = result.profile_data;
                html += `
                    <div class="cyber-section-title">Profile Results</div>
                    <div class="cyber-section-content">
                        <ul>
                            <li>Function: ${profile.function_name}</li>
                            <li>Execution Time: ${profile.execution_time} seconds</li>
                            <li>Memory Usage: ${profile.memory_usage} MB</li>
                            <li>CPU Usage: ${profile.cpu_usage}%</li>
                            <li>Call Count: ${profile.call_count}</li>
                        </ul>
                    </div>
                `;
            }
            
            html += '</div>';
            $('#performanceResults').html(html);
        }
        
        function benchmarkAlternatives() {
            const codeVersions = $('#codeVersions').val().trim();
            const testInputs = $('#benchmarkInputs').val().trim();
            
            if (!codeVersions || !testInputs) {
                $('#performanceResults').html('<div class="cyber-result-card">Please enter code versions and test inputs for benchmarking.</div>');
                return;
            }
            
            $('#performanceResults').html('<div class="cyber-result-card">Benchmarking alternatives...</div>');
            
            $.ajax({
                url: '/benchmark_alternatives',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    code_versions: codeVersions,
                    test_inputs: testInputs
                }),
                success: function(result) {
                    renderBenchmarkResult(result);
                },
                error: function(xhr) {
                    $('#performanceResults').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        }
        
        function renderBenchmarkResult(result) {
            let html = '<div class="cyber-result-card">';
            html += '<div class="cyber-result-header"><span class="cyber-model-name">Benchmark Results</span></div>';
            
            if (result.benchmark_data && result.benchmark_data.length > 0) {
                html += '<div class="cyber-section-title">Performance Comparison</div>';
                result.benchmark_data.forEach(version => {
                    html += `
                        <div class="cyber-section-content" style="border-left: 4px solid #39ff14; padding-left: 12px; margin-bottom: 12px;">
                            <strong>${version.name}</strong><br>
                            <strong>Execution Time:</strong> ${version.execution_time} seconds<br>
                            <strong>Memory Usage:</strong> ${version.memory_usage} MB<br>
                            <strong>Performance Score:</strong> ${version.performance_score}/100
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            $('#performanceResults').html(html);
        }
        
        // Toggle function profiling section
        function toggleFunctionProfiling() {
            $('#functionProfiling').toggle();
        }
        
        // Toggle benchmark section
        function toggleBenchmarkSection() {
            $('#benchmarkSection').toggle();
        }
        
        // Multimodal Analysis Functions
        $('#analyze-image-gemini').click(function() { analyzeImage('gemini'); });
        $('#analyze-image-claude').click(function() { analyzeImage('claude'); });
        $('#analyze-image-all').click(function() { analyzeImage('all'); });
        
        function analyzeImage(model) {
            const fileInput = document.getElementById('image-input');
            const prompt = $('#analysis-prompt').val() || 'Analyze this image and provide insights.';
            
            if (!fileInput.files[0]) {
                $('#cyber-multimodal-results').html('<div class="cyber-result-card">Please select an image first.</div>');
                return;
            }
            
            $('#cyber-multimodal-results').html('<div class="cyber-result-card">Analyzing image with ' + model + '...</div>');
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('prompt', prompt);
            formData.append('model', model);
            
            $.ajax({
                url: '/analyze_image',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(result) {
                    $('#cyber-multimodal-results').html(renderImageResult(model, result));
                },
                error: function(xhr) {
                    $('#cyber-multimodal-results').html(renderImageResult(model, xhr.responseJSON || {error: 'Unknown error'}));
                }
            });
        }
        
        function renderImageResult(model, result) {
            if(result.error) {
                return `<div class='cyber-result-card'><b>Error:</b> ${result.error}</div>`;
            }
            
            let html = `<div class='cyber-result-card'>
                <div class='cyber-result-header'>
                    <span class='cyber-model-name'>${model}</span>
                    <span class='cyber-execution-time'>${result.execution_time ? 'â± ' + result.execution_time + 's' : ''}</span>
                </div>
                <div class='cyber-section-title'>Analysis</div>
                <div class='cyber-section-content'>${result.analysis || 'No analysis available.'}</div>
            </div>`;
            
            return html;
        }
        
        // Search functionality
        $('#search-btn').click(function() {
            const query = $('#cyber-search').val().trim();
            if (!query) {
                $('#cyber-search-results').html('<div class="cyber-result-card">Please enter a search query.</div>');
                return;
            }
            
            $('#cyber-search-results').html('<div class="cyber-result-card">Searching...</div>');
            
            $.ajax({
                url: '/search',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ query: query }),
                success: function(result) {
                    $('#cyber-search-results').html(renderSearchResult(result));
                },
                error: function(xhr) {
                    $('#cyber-search-results').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        });
        
        function renderSearchResult(result) {
            if (!result.results || result.results.length === 0) {
                return '<div class="cyber-result-card">No results found.</div>';
            }
            
            let html = '<div class="cyber-result-card">';
            html += '<div class="cyber-section-title">Search Results</div>';
            
            result.results.forEach(item => {
                html += `
                    <div class="cyber-section-content" style="border-left: 4px solid #39ff14; padding-left: 12px; margin-bottom: 12px;">
                        <strong>${item.title}</strong><br>
                        <strong>Score:</strong> ${item.score}<br>
                        <strong>Content:</strong> ${item.content}
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        // Stats functionality
        $('#refresh-stats').click(function() {
            $('#cyber-stats-results').html('<div class="cyber-result-card">Loading stats...</div>');
            
            $.ajax({
                url: '/stats',
                method: 'GET',
                success: function(result) {
                    $('#cyber-stats-results').html(renderStatsResult(result));
                },
                error: function(xhr) {
                    $('#cyber-stats-results').html('<div class="cyber-result-card">Error: ' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Unknown error') + '</div>');
                }
            });
        });
        
        function renderStatsResult(result) {
            let html = '<div class="cyber-result-card">';
            html += '<div class="cyber-section-title">Statistics</div>';
            html += '<div class="cyber-section-content">';
            
            if (result.total_analyses) {
                html += `<strong>Total Analyses:</strong> ${result.total_analyses}<br>`;
            }
            if (result.average_quality_score) {
                html += `<strong>Average Quality Score:</strong> ${result.average_quality_score}<br>`;
            }
            if (result.most_analyzed_language) {
                html += `<strong>Most Analyzed Language:</strong> ${result.most_analyzed_language}<br>`;
            }
            if (result.total_execution_time) {
                html += `<strong>Total Execution Time:</strong> ${result.total_execution_time} seconds<br>`;
            }
            
            html += '</div></div>';
            return html;
        }
        
        // Image upload handling
        $('#upload-zone').click(function() {
            $('#image-input').click();
        });
        
        $('#image-input').change(function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    $('#image-preview').attr('src', e.target.result);
                    $('#image-preview-container').show();
                    $('#upload-zone').hide();
                    
                    // Update image info
                    const size = (file.size / 1024 / 1024).toFixed(2);
                    $('#image-info').html(`Size: ${size} MB | Type: ${file.type}`);
                };
                reader.readAsDataURL(file);
            }
        });
        
        $('#remove-image').click(function() {
            $('#image-input').val('');
            $('#image-preview-container').hide();
            $('#upload-zone').show();
        });
        
        // Drag and drop for image upload
        $('#upload-zone').on('dragover', function(e) {
            e.preventDefault();
            $(this).addClass('drag-over');
        });
        
        $('#upload-zone').on('dragleave', function(e) {
            e.preventDefault();
            $(this).removeClass('drag-over');
        });
        
        $('#upload-zone').on('drop', function(e) {
            e.preventDefault();
            $(this).removeClass('drag-over');
            
            const files = e.originalEvent.dataTransfer.files;
            if (files.length > 0) {
                $('#image-input')[0].files = files;
                $('#image-input').trigger('change');
            }
        });
        
        // Mobile-specific enhancements
        $(document).ready(function() {
            // Auto-resize textareas on mobile
            $('.cyber-textarea').on('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Haptic feedback for mobile buttons
            if ('vibrate' in navigator) {
                $('.cyber-btn, .cyber-tab').on('touchstart', function() {
                    navigator.vibrate(10);
                });
            }
            
            // Handle orientation change
            $(window).on('orientationchange', function() {
                setTimeout(function() {
                    $(window).trigger('resize');
                }, 100);
            });
            
            // Mobile FAB functionality
            $('.mobile-fab').click(function() {
                $(this).toggleClass('active');
            });
            
            // Close FAB menu when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.mobile-fab').length) {
                    $('.mobile-fab').removeClass('active');
                }
            });
        });
        
        // Utility functions
        function renderMarkdown(text) {
            // Basic markdown to HTML conversion
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }
        
        // Global variables
        let lastAnalysisResult = null;
        let lastModel = null;
        
        const SUPPORTED_LANGUAGES = [
            { value: 'python', label: 'Python' },
            { value: 'javascript', label: 'JavaScript' },
            { value: 'java', label: 'Java' },
            { value: 'cpp', label: 'C++' },
            { value: 'csharp', label: 'C#' },
            { value: 'php', label: 'PHP' },
            { value: 'ruby', label: 'Ruby' },
            { value: 'go', label: 'Go' },
            { value: 'rust', label: 'Rust' },
            { value: 'swift', label: 'Swift' },
            { value: 'kotlin', label: 'Kotlin' },
            { value: 'typescript', label: 'TypeScript' },
            { value: 'html', label: 'HTML' },
            { value: 'css', label: 'CSS' },
            { value: 'sql', label: 'SQL' },
            { value: 'bash', label: 'Bash' },
            { value: 'powershell', label: 'PowerShell' },
            { value: 'r', label: 'R' },
            { value: 'matlab', label: 'MATLAB' },
            { value: 'scala', label: 'Scala' },
            { value: 'perl', label: 'Perl' },
            { value: 'lua', label: 'Lua' },
            { value: 'dart', label: 'Dart' },
            { value: 'elixir', label: 'Elixir' },
            { value: 'clojure', label: 'Clojure' },
            { value: 'haskell', label: 'Haskell' },
            { value: 'fsharp', label: 'F#' },
            { value: 'ocaml', label: 'OCaml' },
            { value: 'erlang', label: 'Erlang' },
            { value: 'cobol', label: 'COBOL' },
            { value: 'fortran', label: 'Fortran' },
            { value: 'pascal', label: 'Pascal' },
            { value: 'ada', label: 'Ada' },
            { value: 'assembly', label: 'Assembly' },
            { value: 'unknown', label: 'Unknown' }
        ];

        $('#test-upload-btn').click(function() {
            console.log('Test button clicked - opening file picker');
            $('#image-input').trigger('click');
        });

        $('#image-input').on('change', function(e) {
            console.log('File input changed - file selected');
            handleImageFile(e.target.files[0]);
        });
    </script>
</body>
</html>